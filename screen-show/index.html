<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/bigdata.css">
    <link rel="stylesheet" type="text/css" href="css/swiper.min.css">
    <title>大屏展示</title>
</head>

<body>
    <div id="unicom-bigdata">
        <!-- 告警总数走势折线图 -->
        <div id="gjzszs">
            <h2 class="h2 _t_center">告警总数走势折线图</h2>
            <div id="gjzszs-echarts"></div>
            <!-- 单位：时间 -->
            <div id="gjzszs-shijian">时间</div>
        </div>
        <!-- 设备机房分布图 -->
        <div id="sbjf">
            <h2 class="h2 _t_center">设备机房分布图</h2>
            <div id="sbjf-echarts"></div>
            <div id="sbjf-tai">(台)</div>
            <!-- <div id="sbjf-name"></div> -->
        </div>
        <!-- 各机房设备类型分布 -->
        <div id="sblx">
            <h2 class="h2 _t_center">各机房设备类型分布</h2>
            <div id="sblx-echarts"></div>
            <div id="sblx-titledata"></div>
            <div class="jiantou"></div>
        </div>
        <!-- 系统健康状态 -->
        <div id="xtjkzt">
            <h2 class="h2 _t_center">系统健康状态</h2>
            <div class="bk-3">
                <h3 id="zy-t">亦庄数据中心</h3>
                <h3 id="lf-t">廊坊数据中心</h3>
                <div id="score"></div>
                <div id="infomation">
                    <div><span class="static-0"></span>正常</div>
                    <div><span class="static-1"></span>信息</div>
                    <div><span class="static-2"></span>轻微</div>
                    <div><span class="static-3"></span>一般</div>
                    <div><span class="static-4"></span>重要</div>
                    <div><span class="static-5"></span>紧急</div>
                </div>
                <div class="swiper-container">
                    <ul class="swiper-wrapper">
                        <!--  -->
                    </ul>
                </div>
            </div>
            <div class="center-data">90</div>
        </div>
    </div>
    <script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="js/swiper.min.js"></script>
    <script type="text/javascript" src="js/echarts.min.js"></script>
    <script type="text/javascript">




    //----------------------------------------------------------------------------------
    // 系统健康状态
    //----------------------------------------------------------------------------------
    var LFDATA = {};
    var YZDATA = {};
    var counter = 0;
    var swiper;

    function initData() {
			
		$.ajax({
            type: "post",
            url: "http://10.245.7.118:9080/Exhibition/tyexhibition/getExhibitionlf",
            dataType: "json",
            success: function(datajson) {
                // console.log(datajson.data);
                LFDATA = datajson.data;
                addCounter();
            }
        });

        $.ajax({
            type: "post",
            url: "http://10.245.7.118:9080/Exhibition/tyexhibition/getExhibitionyz",
            dataType: "json",
            success: function(datajson) {
                YZDATA = datajson.data;
                addCounter();
            }
        });

        function addCounter() {
            ++counter
            if (counter == 2) {
                // console.log(LFDATA);
                // console.log(YZDATA);
                // 亦庄数据长度
                var yzLength = YZDATA.length;
                // 廊坊数据长度
                var lfLength = LFDATA.length;
                // 取最大长度
                var maxNum = Math.max(yzLength, lfLength);
                $("ul.swiper-wrapper").html("");
                for (var i = 0; i < maxNum; i++) {
                    // 亦庄 填充文字
                    var yz_context = YZDATA[i % yzLength].sys_name.length > 15 ? YZDATA[i % yzLength].sys_name.substring(0, 15) + '..' : YZDATA[i % yzLength].sys_name;
                    // 廊坊 填充文字
                    var lf_context = LFDATA[i % lfLength].sys_name.length > 15 ? LFDATA[i % lfLength].sys_name.substring(0, 15) + '...' : LFDATA[i % lfLength].sys_name;
                    // 亦庄 状态圆形显示颜色
                    var yz_status = YZDATA[i % yzLength].priority;
                    // 廊坊 状态圆形显示颜色
                    var lf_status = LFDATA[i % lfLength].priority;
                    var yz_html = '<div class="left-data"><span class="infor-' + yz_status + '"></span>' + yz_context + '</div>';
                    var lf_html = '<div class="right-data"><span class="infor-' + lf_status + '"></span>' + lf_context + '</div>';
                    var html = yz_html + lf_html;
                    $("<li />", {
                        html: html,
                        'class': 'swiper-slide'
                    }).appendTo('ul.swiper-wrapper');
                }
                if (swiper) {
                    swiper.destroy();
                }
                swiper = new Swiper('.swiper-container', {
                    direction: 'vertical',
                    loop: true, // 环路
                    slidesPerView: 5, //每页显示条数
                    simulateTouch: false, //鼠标拖动事件
                    autoplay: {
                        delay: 8000,
                        disableOnInteraction: false,
                    }
                });
            }
        }
        // });
    }
    initData();
    setInterval(function() {
        counter = 0;
        initData();
    }, 400000);
    //----------------------------------------------------------------------------------
    // 设备机房分布图
    //----------------------------------------------------------------------------------
    function sbjfInit() {
        function echartsInit(datajson) {
            var data1 = [];
            var data2 = [];
            var dataShadow = [];

            $.each(datajson.data, function(index, val) {
                $.each(val, function(i, v) {
                    data1.push(v.jifangname);
                    data2.push(v.cons);
                })
            });


            var sbjf_echarts = echarts.init($("#sbjf-echarts")[0]);
            var maxNum = Math.max.apply({}, data2);
            maxNum = 3000;
            for (var i = 0; i < data1.length; i++) {
                dataShadow.push(maxNum);
            }
            var option = {
                title: {
                    // text: ''
                },
                textStyle: {
                    color: 'rgb(255, 255, 255)',
                    fontSize: 4
                },
                tooltip: {
                    show: false
                },
                legend: {
                    // data: ['']
                },
                grid: [{
                    width: '85%',
                    left: 0,
                    right: 0,
                    containLabel: true,
                }],
                xAxis: {
                    // offset: 20,
                    data: data1,
                    axisLabel: {
                        interval: 0,
                        rotate: -45,
                        fontSize: 9,
                        textStyle: {
                            color: 'rgba(255,255,255,1)'
                        }
                    },
                    nameTextStyle: {
                        fontSize: 20
                    },
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                        },
                        show: true
                    },
                },
                yAxis: {
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                        },
                        show: true
                    },
                    axisLabel: {
                        fontSize: 10,
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    },
                },
                series: [{ // For shadow
                    type: 'bar',
                    itemStyle: {
                        normal: { color: 'rgba(255,255,255,0.1)' }
                    },
                    barGap: '-100%',
                    barCategoryGap: '40%',
                    data: dataShadow,
                    animation: false
                    // animationDelay: function(idx) {
                    //     return idx * 500;
                    // }
                }, {
                    type: 'bar',
                    data: data2,
                    itemStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1, [
                                    { offset: 0, color: '#83bff6' },
                                    { offset: 0.5, color: '#188df0' },
                                    { offset: 1, color: '#188df0' }
                                ]
                            )
                        }
                    },
                    animationDelay: function(idx) {
                        return idx * 500;
                    }
                }]
            };
            sbjf_echarts.setOption(option);
            // 非canvas 直接生成文字，应客户需求实现文字垂直显示
            /*(function verticalText(el, names) {
                $.each(names, function(index, val) {
                    $("<div />", {
                        html: val
                    }).appendTo(el);
                });
            })($("#sbjf-name"), data1);*/

            setInterval(function() {
                sbjf_echarts.clear();
                sbjf_echarts.setOption(option);
            }, 20000);
        }
        $.ajax({
                url: "http://10.245.7.118:9080/Exhibition/tyexhibition/getJifangHosts",
                type: 'POST',
                dataType: 'json',
            })
            .done(function(datajson) {
                echartsInit(datajson);
            })
            .fail(function() {
                // console.log("error");
            })
            .always(function() {
                // console.log("complete");
            });
    }
    sbjfInit();
    //----------------------------------------------------------------------------------
    // 各机房设备类型分布 
    //----------------------------------------------------------------------------------
    function sblxInit() {
        $.ajax({
                url: 'https://zxs0827.github.io/web-back/JSON/shebeidata.json',
                type: 'GET',
                dataType: 'json',
            })
            .done(function(datajson) {

                // console.log("success");
                var arrHosts = [];
                var hostsCount = 0;
                var eachCount = 0;

                var titleData = [];

                $.each(datajson.data, function(index, val) {
                    $.each(val, function(index, val) {
                        titleData.push(val.jifangname);

                        arrHosts[eachCount] = new Array();

                        $.each(val.data, function(index, val) {
                            // 临时
                            if (val.cons === 0) {
                                val.cons = 20;
                            }

                            arrHosts[eachCount].push({
                                value: val.cons,
                                name: val.host_type + ':' + val.cons
                            });
                        });

                        eachCount++;
                    });
                });

                $("#sblx-titledata").text(titleData[0]);
                $(".jiantou").css("opactiy", "1");

                // 替代函数
                // var arr = [];
                // $.each(datajson.data, function(index, val) {
                //      $.each(val,function(i,v){
                //         $.each(v.data,function(key,value){
                //             value["value"] = value.cons;
                //             value["name"] = value.host_type;
                //             delete value.count;
                //             delete value.cons;
                //             delete value.host_type;
                //         })
                //         arr.push(v.data);
                //      })
                // });


                var sblx_echarts = echarts.init($("#sblx-echarts")[0]);
                var option = {
                    // color: ['rgb(0, 88, 255)', 'rgb(12, 156, 250)'],
                    color: ['rgb(0, 88, 255)', 'rgb(255, 255, 255)'],
                    series: [{
                        type: 'pie',
                        radius: ['45%', '65%'],
                        grid: {
                            width: '100%',
                            left: 0,
                            right: 0,
                            containLabel: true
                        },
                        label: {
                            normal: {
                                show: true,
                                fontSize: 16,
                                lineHeight: 50,
                                position: 'center'
                            }
                        },
                        labelLine: {
                            normal: {
                                show: true,
                                length: 1,
                                length2: 10
                            }
                        },
                        data: arrHosts[hostsCount]
                    }]
                }
                sblx_echarts.setOption(option);
                setInterval(function() {
                    hostsCount++;
                    hostsCount = hostsCount % arrHosts.length;

                    option.series[0].data = arrHosts[hostsCount];

                    sblx_echarts.clear();
                    sblx_echarts.setOption(option);

                    $("#sblx-titledata").text(titleData[hostsCount]);
                }, 20000);
            });
    }
    sblxInit();
    //-----------------------------------------------------------------------------------------
    // 告警总数走势折线图
    //-----------------------------------------------------------------------------------------
    function gjzszsInit() {
        function echartsInit(data) {
            var gjzszs_echarts = echarts.init(document.getElementById("gjzszs-echarts"));
            var data1 = [];
            var data2 = [];
            var xData = [];
            var yData = [];
            var lineCount = 0;
            var lineNum = 24;
            $.each(data, function(index, val) {
                // data1.push(val.clock);
                data1.push(val.clock.substring(11, 16));
                data2.push(val.cons);
            });
            xData = data1.slice(lineCount, lineCount + lineNum);
            // alert(xData);
            // console.log(xData);
            yData = data2.slice(lineCount, lineCount + lineNum);
            var maxNum = Math.max.apply({}, data2);
            if (maxNum % 50 > 0) {
                maxNum = Math.ceil(maxNum / 50) * 50;
            }
            var option = {
                grid: {
                    width: '80%',
                },
                xAxis: [{
                    // name: '时间',
                    type: 'category',
                    boundaryGap: false,
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                        },
                        show: true
                    },
                    axisLabel: {
                        fontSize: 10,
                        interval: 0,
                        rotate: -45
                    },

                    data: xData
                }],
                yAxis: [{
                    type: 'value',
                    scale: true,
                    name: '     告警数量',
                    max: maxNum,
                    min: 0,
                    axisLine: {
                        lineStyle: {
                            color: "#fff"
                        },
                        show: true
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255,255,255,0.1)',
                        }
                    },
                    boundaryGap: [0.2, 0.2]
                }],
                series: [{
                    type: 'line',
                    itemStyle: {
                        normal: {
                            color: 'rgba(255, 255, 255,0.6)',
                            shadowBlur: 10,
                            shadowColor: 'white'
                        }
                    },
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: 'rgba(107, 107, 255,0.4)'
                            }, {
                                offset: 0.8,
                                color: 'rgba(0, 230, 255, 0.4)'
                            }])
                        }
                    },
                    symbolSize: 8,
                    data: yData
                }]
            };
            gjzszs_echarts.setOption(option);

            setInterval(function() {
                gjzszs_echarts.clear();
                gjzszs_echarts.setOption(option);
            }, 20000);

            // setInterval(function() {
            //     lineCount++;
            //     lineCount = lineCount % data.length;
            //     var xAxis = option.xAxis[0].data;
            //     var series = option.series[0].data;
            //     xAxis.shift();
            //     // xAxis.push(data1[lineCount + lineNum - 1] % data.length) ;
            //     xAxis.push(data1[(lineCount + lineNum - 1) % data.length]);
            //     series.shift();
            //     // series.push(data2[lineCount + lineNum - 1]);
            //     series.push(data2[(lineCount + lineNum - 1) % data.length]);
            //     gjzszs_echarts.setOption(option);
            // }, 60000);
        }
			
		$.ajax({
            type: "post",
            url: "http://10.245.7.118:9080/Exhibition/tyexhibition/getsygj",
            dataType: "json",  
        })
		.done(function(datajson) {
            // console.log("aaa");
            // console.log(datajson);
			echartsInit(datajson.data);
		})
		.fail(function() {
			// console.log("error2");
		})
		.always(function() {
			// console.log("complete2");
		});
    }
    gjzszsInit();

    </script>
</body>

</html>